<!-- HEADER -->

<script>

const urlPathName = window.location.pathname.split("/")[1]
console.log(urlPathName)

window.addEventListener("DOMContentLoaded", getHeader)

async function getHeader() {
    const res = await fetch(`/api/${urlPathName}/show-info/`)
    const data = await res.json()

    data.forEach(item => infoToHTML(item))
}

function infoToHTML({
    display_name,
    slug_artist,
    profile_url,
    avatar_image,
    header_image,
    verification,
    first_name,
    last_name,
    city,
    country,
    bio,
    username }) {

    // show main code header
    const headerContainerHTMLid = document.getElementById("artist-header-container")
    headerContainerHTMLid.insertAdjacentHTML('beforeend', `
        <div class="artist-header">
            <div class="background-artist">      
                <img class="background-artist-img" src="${header_image}"></img>
            </div>
            <div class="artist-info">
                <div class="avatar-profile-block">
                    <img class="avatar-profile-img" src="${avatar_image}"></img>  
                </div>
                <div class="artist-data"> 
                    <div class="nick-name">${display_name} (login: ${currentUser})
                    </div>  
                    <div class="name-block">                    
                    </div>
                    <div class="country-city-block">                    
                    </div> 
                </div>
            </div>
        </div>
        `)
    
    // show edit avatar button
    if ((currentUserAuthenticated) && (currentUser == username.username)) {
        getClassPutHTMLAfterTag(
            "avatar-profile-img", `
            <div class="edit-avatar-button">
                <button onclick="editAvatarDrop()" class="avatar-button"><i class="fa-solid fa-camera"></i>&nbsp Update image</button>
                <div class="dropdown-content-edit-avatar">
                    <a href="#">Replace image</a>
                    <a href="#">Delete image</a>                
                </div>
            </div>
        `)
    }    

    // show verification
    if (verification) {
        getClassPutHTMLBeforeEndTag(
            "nick-name", `
            &nbsp<i class="fa-solid fa-circle-check" style="color: #3588d8; background-color: white; border-radius: 50%;"></i>
        `)
    }

    // show first name
    if (first_name) {
        getClassPutHTMLAfterBeginTag(
            "name-block",
            `<div class="name">${first_name}</div>
        `)
    }

    // show last name
    if (last_name) {
        getClassPutHTMLBeforeEndTag(
            "name-block",
            `<div class="name">${last_name}</div>
        `)
    }

    // show city
    if (city) {
        getClassPutHTMLAfterBeginTag(
            "country-city-block",
            `<div class="country-city">${city}</div>
        `)
    }

    // show country
    if (country) {
        getClassPutHTMLBeforeEndTag(
            "country-city-block",
            `<div class="country-city">${country}</div>
        `)
    }

    // show pro user
    if (username.pro_user) {
        getClassPutHTMLBeforeEndTag(
            "artist-data",
            `<div class="pro-user"><i class="fa-solid fa-certificate" style="color: #fe5621;"></i>&nbsp NEXT PRO</div>
        `)
    }

    // show edit header button
    if ((currentUserAuthenticated) && (currentUser == username.username)) {
        getClassPutHTMLAfterTag(
            "artist-data", `
            <div class="edit-background">
                <button onclick="editBackgroundDrop()" class="background-button"><i class="fa-solid fa-camera"></i>&nbsp Update image</button>
                <div class="dropdown-content-edit-background">
                    <a href="#">Replace image</a>
                    <a href="#">Delete image</a>                
                </div>
            </div>
        `)
    }
}

// edit avatar
function editAvatarDrop() {  
    document.querySelector(".dropdown-content-edit-avatar").classList.toggle("show-edit-avatar")  
}  
document.addEventListener("click", function(event) {
    if (!event.target.matches(".avatar-button")) { 
        document.querySelector(".dropdown-content-edit-avatar").classList.remove("show-edit-avatar")
    }
})


// edit header
function editBackgroundDrop() {  
    document.querySelector(".dropdown-content-edit-background").classList.toggle("show-edit-background")  
}  
document.addEventListener("click", function(event) {
    if (!event.target.matches(".background-button")) { 
        document.querySelector(".dropdown-content-edit-background").classList.remove("show-edit-background")    
    }
}) 

</script>

{% include 'modal-image-view.html' %}
